<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bubble Chat</title>
    <link rel="icon" type="image/png" href="favicon.png">

    <style>
        body {
            margin: 0;
            background: #f0f2f5;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        #header {
            background: #4e8df5;
            color: white;
            padding: 12px;
            font-size: 18px;
            text-align: center;
            font-weight: bold;
        }

        #onlineCount {
            font-size: 14px;
            opacity: 0.9;
        }

        #messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .msg {
            background: white;
            padding: 10px;
            margin: 8px 0;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .avatar {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            background: #d9d9d9;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 18px;
        }

        .nick {
            font-weight: bold;
        }

        #bottom {
            display: flex;
            padding: 10px;
            background: #ffffff;
            border-top: 1px solid #ccc;
        }

        #input {
            flex: 1;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #aaa;
            outline: none;
        }

        #sendBtn {
            margin-left: 10px;
            padding: 10px 20px;
            border: none;
            background: #4e8df5;
            color: white;
            border-radius: 10px;
            font-size: 16px;
        }

        @media (max-width: 600px) {
            .msg {
                font-size: 14px;
            }
            #header {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>

<div id="header">
    Bubble Chat  
    <div id="onlineCount">Онлайн: 0</div>
</div>

<div id="messages"></div>

<div id="bottom">
    <input id="input" type="text" placeholder="Написать сообщение...">
    <button id="sendBtn">➤</button>
</div>

<script>
    const nickname = prompt("Введите ваш ник:") || "Гость";

    // Цвет ника (один и тот же всегда)
    function nickColor(nick) {
        let hash = 0;
        for (let i = 0; i < nick.length; i++) {
            hash = nick.charCodeAt(i) + ((hash << 5) - hash);
        }
        const color = `hsl(${hash % 360}, 70%, 50%)`;
        return color;
    }

    const avatarLetter = nickname[0].toUpperCase();

    const socket = new WebSocket("wss://" + window.location.host);

    socket.onmessage = (event) => {
        const data = JSON.parse(event.data);

        if (data.type === "online") {
            document.getElementById("onlineCount").innerText = "Онлайн: " + data.count;
            return;
        }

        const div = document.createElement("div");
        div.className = "msg";

        div.innerHTML = `
            <div class="avatar">${data.nick[0].toUpperCase()}</div>
            <div>
                <div class="nick" style="color:${nickColor(data.nick)}">${data.nick}</div>
                <div>${data.text}</div>
            </div>
        `;

        document.getElementById("messages").appendChild(div);
        div.scrollIntoView({ behavior: "smooth" });
    };

    function send() {
        const text = document.getElementById("input").value.trim();
        if (!text) return;

        socket.send(JSON.stringify({ nick: nickname, text }));
        document.getElementById("input").value = "";
    }

    document.getElementById("sendBtn").onclick = send;

    document.getElementById("input").addEventListener("keydown", (e) => {
        if (e.key === "Enter") send();
    });
</script>

</body>
</html>
