<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bubble Chat</title>
    <link rel="icon" type="image/png" href="favicon.png">

    <style>
        :root {
            --bg: #f0f2f5;
            --header: #4e8df5;
            --text: #000;
            --msg-bg: #fff;
            --input-bg: #fff;
        }

        body.dark {
            --bg: #1e1e1e;
            --header: #2d61d0;
            --text: #fff;
            --msg-bg: #2a2a2a;
            --input-bg: #333;
        }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            transition: 0.2s;
        }

        #header {
            background: var(--header);
            color: white;
            padding: 10px;
            font-size: 18px;
            text-align: center;
            position: relative;
        }

        #themeBtn {
            position: absolute;
            right: 10px;
            top: 10px;
            background: rgba(255,255,255,0.3);
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            color: white;
            cursor: pointer;
        }

        #messages {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .msg {
            background: var(--msg-bg);
            color: var(--text);
            padding: 10px;
            margin: 8px 0;
            border-radius: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0,0,0,0.1);
        }

        .nick {
            font-weight: bold;
        }

        #bottom {
            display: flex;
            padding: 10px;
            background: var(--msg-bg);
        }

        #input {
            flex: 1;
            padding: 10px;
            background: var(--input-bg);
            color: var(--text);
            border-radius: 10px;
            border: 1px solid #aaa;
            outline: none;
        }

        #sendBtn {
            margin-left: 10px;
            padding: 10px 20px;
            background: #4e8df5;
            border: none;
            color: white;
            border-radius: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div id="header">
    Bubble Chat
    <button id="themeBtn">üåô</button>
    <div id="onlineCount" style="font-size:13px; opacity:0.9;">–û–Ω–ª–∞–π–Ω: 0</div>
</div>

<div id="messages"></div>

<div id="bottom">
    <input id="input" type="text" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ...">
    <button id="sendBtn">‚û§</button>
</div>

<script>
    const nickname = prompt("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫:") || "–ì–æ—Å—Ç—å";

    // –°–º–æ–ª–π–∏–∫–∏ –≤ –∞–≤–∞—Ç–∞—Ä
    const emojis = ["üòÄ","üòÅ","üòé","üòú","üò∫","üê∏","üêµ","üê±","‚ú®","üî•"];
    const avatar = emojis[Math.floor(Math.random() * emojis.length)];

    function nickColor(nick) {
        let hash = 0;
        for (let i = 0; i < nick.length; i++) {
            hash = nick.charCodeAt(i) + ((hash << 5) - hash);
        }
        return `hsl(${hash % 360}, 70%, 55%)`;
    }

    const socket = new WebSocket("wss://" + window.location.host);

    socket.onmessage = (event) => {
        const data = JSON.parse(event.data);

        if (data.type === "online") {
            onlineCount.innerText = "–û–Ω–ª–∞–π–Ω: " + data.count;
            return;
        }

        const div = document.createElement("div");
        div.className = "msg";

        div.innerHTML = `
            <div class="avatar">${data.avatar}</div>
            <div>
                <div class="nick" style="color:${nickColor(data.nick)}">${data.nick}</div>
                <div>${data.text}</div>
            </div>
        `;

        messages.appendChild(div);
        div.scrollIntoView({behavior: "smooth"});
    };

    function send() {
        const text = input.value.trim();
        if (!text) return;

        socket.send(JSON.stringify({
            nick: nickname,
            avatar: avatar,
            text: text
        }));

        input.value = "";
    }

    sendBtn.onclick = send;
    input.addEventListener("keydown", e => {
        if (e.key === "Enter") send();
    });

    // –¢–µ–º–Ω–∞—è —Ç–µ–º–∞
    const themeBtn = document.getElementById("themeBtn");
    themeBtn.onclick = () => {
        document.body.classList.toggle("dark");
        themeBtn.textContent = document.body.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô";
    };
</script>

</body>
</html>
